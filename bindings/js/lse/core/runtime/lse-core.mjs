import{performance as t}from'perf_hooks';import{normalize as e,join as s,dirname as i}from'path';import{createRequire as r}from'module';const n=Object.freeze([]);const o=(t,e,s)=>s?t|1<<e:t&~(1<<e);const a=(t,e)=>(t&1<<e)!==0;const h=t=>typeof t==='object'&&t?.constructor===Object;const l=t=>new Map(Array.from(t,(t=>t.reverse())));const{now:u}=t;const c=()=>{if(!Array.prototype.at){Object.defineProperty(Array.prototype,'at',{value:function(t){t=t>>>0;t<0&&(t+=this.length);if(t>=0&&t<this.length)return this[t]},writable:true,enumerable:false,configurable:true})}};const d=(t,e)=>{throw Error(`illegal argument: ${t}: ${e}`)};const g=r(import.meta.url);const f=t=>{if(t.try?.length){for(const i of t.try){const r=e(s(...i.map((e=>e==='bindings'?t.bindings:e))));try{return g(r)}catch(t){console.warn(`bindings: '${t.message}' - ${r}`)}}}const{env:i,execPath:r,platform:n}=process;let o=i.LSE_BUILD_TYPE?.toLowerCase();let a;if(n==='win32'){a=s(r,'..','..')}else{a=s(r,'..','..','..')}a=e(a);if(o!=='release'||o!=='debug'){o='release'}return g(s(a,'intrinsic','@lse','core',o,t.bindings))};const p='lse-core.node';const y=()=>{let{LSE_CORE_PATH:t}=process.env;if(!t){return}if(t.endsWith(p)){t=i(t)}return[[t,'bindings']]};const m=()=>{const t={bindings:p,try:y()};if(!t.try){delete t.try}try{return f(t)}catch(e){console.error(`Failed to load ${t.bindings}: ${e.message}`);process.exit(1)}};const{$env:E,nsfont:b,nsgamepad:w,nsimage:A,nskeyboard:_,nsglobal:T,nsnode:P,$style:R,$window:I}=m();const{$getDisplayModes:N,$getDesktopDisplayMode:S,$getCurrentDisplayMode:C,$getDisplayName:L,$findClosestDisplayMode:x}=E;class v{_env=null;_index=-1;constructor(t,e){this._env=t;this._index=e??-1}get index(){return this._index}get name(){return L(this._env,this._index)}get desktopDisplayMode(){return S(this._env,this._index)}get currentDisplayMode(){return C(this._env,this._index)}get displayModes(){return N(this._env,this._index)}findClosestDisplayMode(t,e){return x(this._env,this._index,t,e)}}class D{emit(t,...e){const s=typeof t==='symbol'?t:$(t);const i=this[s];if(!i){return}const{length:r}=i;let n=0;for(let t=0;t<r;t++){try{i[t]?.(...e)}catch(t){console.error(`unhandled listener error: ${t.message}`,'emit()')}if(!i[t]){n++}}if(n){if(n===i.length){i.length=0}else{this[s]=i.filter(Boolean)}}}emitEvent(t){this.emit(t.$type,t)}on(t,e){const s=typeof t==='symbol'?t:$(t);const i=e;const r=this;typeof e==='function'||O(t);(r[s]??(r[s]=[])).push(e);return()=>r.off(s,i)}off(t,e){const s=this[typeof t==='symbol'?t:$(t)];let i=s?.length??0;while(--i){if(s[i]===e){s[i]=null}}}hasListeners(t){return!!this[typeof t==='symbol'?t:$(t)]?.length}}const $=t=>typeof t==='string'?Symbol.for(t):K();const K=t=>{throw Error(`Expected event type to be a symbol or string. Got ${t}`)};const O=t=>{throw Error(`Expected listener to be a Function. Got ${t}`)};const F=Symbol.for;const M=F('before-destroy');const U=F('after-destroy');const k=F('before-configure');const H=F('after-configure');const B=F('ongamepadconnected');const W=F('ongamepaddisconnected');const G=F('ongamepadbuttondown');const Y=F('ongamepadbuttonup');const X=F('ongamepadaxis');const j=F('ongamepadhat');const V=F('onkeyboardbuttondown');const z=F('onkeyboardbuttonup');const Q=F('onkeydown');const q=F('onkeyup');const J=F('onanalogmotion');const Z=F('onfocus');const tt=F('onfocusin');const et=F('onfocusout');const st=F('onblur');const{now:it}=t;const{$configure:rt,$destroy:nt,$update:ot,$getVideoDrivers:at,$getDisplayCount:ht,$getRenderers:lt,$newInstance:ut,$addFont:ct,$isConfigured:dt,$isError:gt,$isDestroyed:ft,$isRunning:pt,$addWindow:yt,$removeWindow:mt}=E;class Et extends D{#t=null;#e=[];#s=null;static new(){return ut()}configure(t={}){if(this.isConfigured()){throw Error('init can only be called once')}for(const e in t){if(typeof t[e]==='boolean'){({enabled:t[e]})}else{t[e]}}this.emitEvent({$type:k,env:this});rt(this,t);this.emitEvent({$type:H,env:this});let e=it();this.#t=setInterval((()=>{const t=it();this.#s.$onFrame(t,e);e=t;if(!ot(this)){this.destroy()}}),1e3/60)}destroy(){clearInterval(this.#t);this.#t=null;this.emitEvent({$type:M,env:this});if(this.#s){this.#s.$notifyBeforeDestroy();try{mt(this,this.#s)}catch(t){}this.#s?.$notifyAfterDestroy();this.#s=null}this.#e=[];try{nt(this)}catch(t){}this.emitEvent({$type:U,env:this})}get videoDrivers(){return at(this)||[]}get renderers(){return lt(this)||[]}get displays(){const t=ht(this);const e=[];for(let s=0;s<t;s++){e.push(new v(this,s))}return e}get fonts(){return[...this.#e]}addFont(t){let e;const{uri:s,index:i,family:r,style:n,weight:o}=h(t)?t:{uri:t};typeof s==='string'||d('uri',s);typeof r==='string'||d('family',r);this.#e.push(e=ct(this,s,i,r,n,o));return e}isConfigured(){return dt(this)}isRunning(){return pt(this)}isError(){return gt(this)}isDestroyed(){return ft(this)}$addWindow(){if(this.#s){throw Error('only one window per env')}return this.#s=yt(this)}$getPrimaryWindow(){return this.#s}}const{$get:bt,$set:wt}=R;class At{get alignItems(){return bt(this,0)}set alignItems(t){wt(this,0,t)}get alignContent(){return bt(this,1)}set alignContent(t){wt(this,1,t)}get alignSelf(){return bt(this,2)}set alignSelf(t){wt(this,2,t)}get border(){return bt(this,3)}set border(t){wt(this,3,t)}get borderBottom(){return bt(this,4)}set borderBottom(t){wt(this,4,t)}get borderLeft(){return bt(this,5)}set borderLeft(t){wt(this,5,t)}get borderRight(){return bt(this,6)}set borderRight(t){wt(this,6,t)}get borderTop(){return bt(this,7)}set borderTop(t){wt(this,7,t)}get bottom(){return bt(this,8)}set bottom(t){wt(this,8,t)}get display(){return bt(this,9)}set display(t){wt(this,9,t)}get flex(){return bt(this,10)}set flex(t){wt(this,10,t)}get flexBasis(){return bt(this,11)}set flexBasis(t){wt(this,11,t)}get flexDirection(){return bt(this,12)}set flexDirection(t){wt(this,12,t)}get flexGrow(){return bt(this,13)}set flexGrow(t){wt(this,13,t)}get flexShrink(){return bt(this,14)}set flexShrink(t){wt(this,14,t)}get flexWrap(){return bt(this,15)}set flexWrap(t){wt(this,15,t)}get height(){return bt(this,16)}set height(t){wt(this,16,t)}get justifyContent(){return bt(this,17)}set justifyContent(t){wt(this,17,t)}get left(){return bt(this,18)}set left(t){wt(this,18,t)}get margin(){return bt(this,19)}set margin(t){wt(this,19,t)}get marginBottom(){return bt(this,20)}set marginBottom(t){wt(this,20,t)}get marginLeft(){return bt(this,21)}set marginLeft(t){wt(this,21,t)}get marginRight(){return bt(this,22)}set marginRight(t){wt(this,22,t)}get marginTop(){return bt(this,23)}set marginTop(t){wt(this,23,t)}get maxHeight(){return bt(this,24)}set maxHeight(t){wt(this,24,t)}get maxWidth(){return bt(this,25)}set maxWidth(t){wt(this,25,t)}get minHeight(){return bt(this,26)}set minHeight(t){wt(this,26,t)}get minWidth(){return bt(this,27)}set minWidth(t){wt(this,27,t)}get overflow(){return bt(this,28)}set overflow(t){wt(this,28,t)}get padding(){return bt(this,29)}set padding(t){wt(this,29,t)}get paddingBottom(){return bt(this,30)}set paddingBottom(t){wt(this,30,t)}get paddingLeft(){return bt(this,31)}set paddingLeft(t){wt(this,31,t)}get paddingRight(){return bt(this,32)}set paddingRight(t){wt(this,32,t)}get paddingTop(){return bt(this,33)}set paddingTop(t){wt(this,33,t)}get position(){return bt(this,34)}set position(t){wt(this,34,t)}get right(){return bt(this,35)}set right(t){wt(this,35,t)}get top(){return bt(this,36)}set top(t){wt(this,36,t)}get width(){return bt(this,37)}set width(t){wt(this,37,t)}get backgroundColor(){return bt(this,38)}set backgroundColor(t){wt(this,38,t)}get backgroundHeight(){return bt(this,39)}set backgroundHeight(t){wt(this,39,t)}get backgroundImage(){return bt(this,40)}set backgroundImage(t){wt(this,40,t)}get backgroundPositionX(){return bt(this,41)}set backgroundPositionX(t){wt(this,41,t)}get backgroundPositionY(){return bt(this,42)}set backgroundPositionY(t){wt(this,42,t)}get backgroundSize(){return bt(this,43)}set backgroundSize(t){wt(this,43,t)}get backgroundWidth(){return bt(this,44)}set backgroundWidth(t){wt(this,44,t)}get borderColor(){return bt(this,45)}set borderColor(t){wt(this,45,t)}get borderRadius(){return bt(this,46)}set borderRadius(t){wt(this,46,t)}get borderRadiusTopLeft(){return bt(this,47)}set borderRadiusTopLeft(t){wt(this,47,t)}get borderRadiusTopRight(){return bt(this,48)}set borderRadiusTopRight(t){wt(this,48,t)}get borderRadiusBottomLeft(){return bt(this,49)}set borderRadiusBottomLeft(t){wt(this,49,t)}get borderRadiusBottomRight(){return bt(this,50)}set borderRadiusBottomRight(t){wt(this,50,t)}get color(){return bt(this,51)}set color(t){wt(this,51,t)}get filter(){return bt(this,52)}set filter(t){wt(this,52,t)}get fontFamily(){return bt(this,53)}set fontFamily(t){wt(this,53,t)}get fontKerning(){return bt(this,54)}set fontKerning(t){wt(this,54,t)}get fontSize(){return bt(this,55)}set fontSize(t){wt(this,55,t)}get fontStyle(){return bt(this,56)}set fontStyle(t){wt(this,56,t)}get fontWeight(){return bt(this,57)}set fontWeight(t){wt(this,57,t)}get maxLines(){return bt(this,58)}set maxLines(t){wt(this,58,t)}get objectFit(){return bt(this,59)}set objectFit(t){wt(this,59,t)}get objectPositionX(){return bt(this,60)}set objectPositionX(t){wt(this,60,t)}get objectPositionY(){return bt(this,61)}set objectPositionY(t){wt(this,61,t)}get opacity(){return bt(this,62)}set opacity(t){wt(this,62,t)}get overflowWrap(){return bt(this,63)}set overflowWrap(t){wt(this,63,t)}get textAlign(){return bt(this,64)}set textAlign(t){wt(this,64,t)}get textOverflow(){return bt(this,65)}set textOverflow(t){wt(this,65,t)}get textTransform(){return bt(this,66)}set textTransform(t){wt(this,66,t)}get transform(){return bt(this,67)}set transform(t){wt(this,67,t)}get transformOriginX(){return bt(this,68)}set transformOriginX(t){wt(this,68,t)}get transformOriginY(){return bt(this,69)}set transformOriginY(t){wt(this,69,t)}get whiteSpace(){return bt(this,70)}set whiteSpace(t){wt(this,70,t)}}const _t=':focus-within';const Tt=Symbol.for(_t);const Pt=':focus-without';const Rt=Symbol.for(Pt);class It extends At{[Tt]=null;[Rt]=null}const{$reset:Nt,$setParent:St}=R;class Ct extends At{#i=null;reset(){Nt(this);return this}$setParent(t){return this.#i=St(this,t)}}const{$createClass:Lt,$lock:xt,$setParent:vt}=R;const Dt=(t,e)=>t instanceof Ct&&h(e)&&Ft(t,e);const $t=(...t)=>{throw Error('not implemented')};const Kt=t=>{const e=Lt(It);if(!Ft(e,t));Mt(t,e,_t,Tt);Mt(t,e,Pt,Rt);return xt(e)};const Ot=t=>{const e={};for(const[s,i]of Object.entries(t)){e[s]=Kt(i)}return e};const Ft=(t,e)=>{const{prototype:s}=At;for(const i in e){if(i in s){t[i]=e[i]}}return true};const Mt=(t,e,s,i)=>{if(t[s]){const r=Kt(t[s]);if(r){e[i]=r;vt(r,e)}}};const Ut={assign:Dt,flatten:$t,StyleClass:Kt,StyleSheet:Ot};const{$getRoot:kt,$configure:Ht,$setTitle:Bt,$getWidth:Wt,$getHeight:Gt,$getRefreshRate:Yt,$createNode:Xt,$addImage:jt}=I;class Vt extends D{#r='';#n=null;#o=null;#a=[];#h=[];$postWrap(){this.#n=kt(this)}configure(t={}){const{style:e,title:s}=t;Ht(this,t);e&&Ut.assign(this.root.style,e);typeof s==='string'&&(this.title=s)}createNode(t){return Xt(this,t)}addImage(t){if(typeof t==='string'){t={uri:t}}if(!h(t)){d('spec',t)}return jt(this,t.uri)}get activeNode(){return this.#o}get root(){return this.#n}get title(){return this.#r}set title(t){Bt(this,t??'');this.#r=t}get width(){return Wt(this)}get height(){return Gt(this)}get refreshRate(){return Yt(this)}get fullscreen(){return false}get fullscreenMode(){return''}get vsync(){return false}requestAnimationFrame(t){this.#h.push(t);return this.#h.at(-1)}cancelAnimationFrame(t){t<this.#h.length&&(this.#h[t]=null);t<this.#a.length&&(this.#a[t]=null)}$setActiveNode(t){this.#o=t}$notifyBeforeDestroy(){this.emitEvent({$type:M,window:this})}$notifyAfterDestroy(){this.emitEvent({$type:U,window:this});this.#o=null;this.#h.length=0;this.#a.length=0;this.#n.destroy()}$onFrame(t,e){if(this.#h.length){const s=this.#a;this.#a=this.#h;this.#h=s;for(const s of this.#a){try{s?.(t,e)}catch(t){}}this.#a.length=0}}}const zt=0;const Qt=1;const qt=2;class Jt{[0]=-1;[1]=0;constructor(t,...e){this[0]=t;this[1]=e[0]}isFlipH(){return this[0]===zt}isFlipV(){return this[0]===Qt}isTint(){return this[0]===qt}get color(){return this[1]}}class Zt{static UNDEFINED=new Zt(NaN,0);constructor(t,e){this[0]=t;this[1]=e}get value(){return this[0]}get unit(){return this[1]}isUndefined(){return this[1]===0}}const{UNDEFINED:te}=Zt;const ee=0;const se=1;const ie=2;const re=3;class ne{static IDENTITY=ee;static TRANSLATE=se;static SCALE=ie;static ROTATE=re;[0]=-1;[1]=te;[2]=te;constructor(t,...e){switch(t){case se:case ie:this[1]=e[0];this[2]=e[1];break;case re:this[1]=e[0];break;default:throw Error(`invalid transform type: ${t}`)}this[0]=t}get x(){return this[1]}get y(){return this[2]}get angle(){return this[1]}isTranslate(){return this[0]===se}isScale(){return this[0]===ie}isRotate(){return this[0]===re}}const oe=-1;const ae=1;const he=2;class le{#l=oe;constructor(t,e,s=u()){this.$type=t;this.target=e;this.currentTarget=e;this.timestamp=s}get type(){return Symbol.keyFor(this.$type)}stopPropagation(){if(this.cancelable){this.#l=ae}}stopImmediatePropagation(){if(this.cancelable){this.#l=he}}get cancelable(){return this.#l>=0}hasStopPropagation(){return this.#l===ae}hasStopImmediatePropagation(){return this.#l===he}}class ue extends le{gamepad=null;constructor(t,e,s){super(s?B:W,t);this.gamepad=e}}class ce extends le{gamepad=null;hat=0;value=0;constructor(t,e,s,i){super(j,t);this.gamepad=e;this.hat=s;this.value=i}}class de extends le{gamepad=null;axis=0;value=0;constructor(t,e,s,i){super(X,t);this.gamepad=e;this.axis=s;this.value=i}}class ge extends le{gamepad=null;button=-1;pressed=false;repeat=false;constructor(t,e,s,i,r){super(i?G:Y,t);this.gamepad=e;this.button=s;this.pressed=i;this.repeat=r}}class fe extends le{keyboard=null;scancode=-1;pressed=false;repeat=false;constructor(t,e,s,i,r){super(i?V:z,t);this.keyboard=e;this.scancode=s;this.pressed=i;this.repeat=r}}class pe extends le{device=null;key=-1;pressed=false;repeat=false;constructor(t,e,s,i,r){super(i?Q:q,t);this.device=e;this.key=s;this.pressed=i;this.repeat=r}}class ye extends le{device=null;analogKey=0;value=0;constructor(t,e,s,i){super(J,t);this.device=e;this.analogKey=s;this.value=i}}class me extends le{relatedTarget=null;constructor(t,e,s){super(t,e);this.relatedTarget=s}}const{appendChild:Ee,insertBefore:be,removeChild:we,getStyle:Ae,destroy:_e,getX:Te,getY:Pe,getWidth:Re,getHeight:Ie}=P;const Ne=1;const Se=2;class Ce extends D{waypoint=null;#u=n;#c=null;#d=null;#i=null;#g=0;#f=null;constructor(t){super();this.#f=t;this.isLeaf()||(this.#u=[])}appendChild(t){if(Ee(this,t)){this.#u.push(t);t.#i=this}}insertBefore(t,e){const s=this.#u;if(be(this,t,e)){s.splice(s.indexOf(e),0,t);t.#i=this}}removeChild(t){const e=this.#u;const{activeNode:s}=this.#f;if(!we(this,t)){return null}e.splice(e.indexOf(t),1);t.#i=null;if(s){if(s===t){t.blur()}else{let e=s.#i;while(e){if(e===t){t.blur();break}e=e.#i}}}return t}destroy(){if(this.isDestroyed()){return}let t;while(t=this.#u[0]){t.destroy()}if(this.#i){this.#i.removeChild(this);this.#i=null}_e(this);this.#f=null;this.#c=null}get childNodes(){return this.#u}get firstChild(){return this.#u[0]??null}get lastChild(){return this.#u.at(-1)??null}get window(){return this.#f}hasChildNodes(){return!!this.#u.length}isLeaf(){return false}isDestroyed(){return!this.#f}clear(){let t;while(t=this.#u[0]){t.destroy()}}focus(){if(!this.focusable||!this.#p()||this.hasFocus()){return}const t=this.#f;const e=t.activeNode;t.$setActiveNode(this);e?.#y();this.#m();this.#E();e?.#b(this);if(e){e.emitEvent(new me(st,e,this));e.$bubble(new me(et,e,this))}this.emitEvent(new me(Z,this,e));this.$bubble(new me(tt,this,e))}blur(){const t=this.#f;if(this===t.activeNode){t.$setActiveNode(null);this.#y();this.emitEvent(new me(st,this,null));this.$bubble(new me(et,this,null))}}hasFocus(){return this===this.#f.activeNode}get parent(){return this.#i}get style(){return this.#c??(this.#c=Ae(this))}get styleClass(){return this.#d}set styleClass(t){if(this.#w()){this.style.$setParent(t[Rt])}else if(this.hasFocus()||this.#f.activeNode?.#A(this)){this.style.$setParent(t[Tt])}else{this.#d=this.style.$setParent(t)}}get x(){return Te(this)}get y(){return Pe(this)}get width(){return Re(this)}get height(){return Ie(this)}get hidden(){return a(this.#g,Ne)}set hidden(t){this.#g=o(this.#g,Ne,t)}get focusable(){return a(this.#g,Se)}set focusable(t){this.#g=o(this.#g,Se,t)}$bubble(t){let e=this;while(e){e.emitEvent(t);if(t.hasStopPropagation()){return}e=e.#i}}#p(){let t=this;const e=this.#f.root;while(t){if(t===e){return true}t=t.#i}return false}#m(){let t=this;while(t){const e=t.#d?.[Tt];e&&t.#c?.$setParent(e);t=t.#i}}#E(){this.#u.forEach((t=>{const e=t.#d?.[Rt];e&&t.#c?.$setParent(e);t.#E()}))}#y(){this.#u.forEach((t=>t.#y()));this.#c?.$setParent(this.#d)}#w(){let{parent:t}=this;while(t){if(t.hasFocus()){return true}t=t.#i}return false}#A(t){let{parent:e}=this;while(e){if(e===t){return e.hasFocus()}e=e.#i}}#b(t){let e=t;const s=[];while(e){s.push(e);e=e.#i}e=this;while(e){if(!s.includes(e)){e.#c?.$setParent(e.#d)}e=e.#i}}}class Le extends Ce{isLeaf(){return false}get tag(){return'root'}}class xe extends Ce{get tag(){return'box'}isLeaf(){return false}}const{setSource:ve}=P;class De extends Ce{#_='';get tag(){return'img'}isLeaf(){return true}get src(){return this.#_}set src(t){if(typeof t!=='string'){t=''}if(ve(this,t)){this.#_=t}}}const{setText:$e}=P;class Ke extends Ce{#T='';get tag(){return'text'}isLeaf(){return true}get text(){return this.#T}set text(t){if(typeof t!=='string'){t=''}if($e(this,t)){this.#T=t}}}class Oe{width=0;height=0;refreshRate=0;constructor(t,e,s){this.width=t??0;this.height=e??0;this.refreshRate=s??0}toString(){return`${this.width}x${this.height}@${this.refreshRate}hz`}}class Fe{index=-1;name='';hasHardwareAcceleration=false;hasVsync=false;hasRenderToTexture=false;maxTextureWidth=0;maxTextureHeight=0;constructor(t,e,s,i,r,n,o){this.index=t??-1;this.name=e??'';this.hasHardwareAcceleration=s??false;this.hasVsync=i??false;this.hasRenderToTexture=r??false;this.maxTextureWidth=n??0;this.maxTextureHeight=o??0}toString(){return this.name}}const{getId:Me,getUUID:Ue,getName:ke,isConnected:He,getButtonCount:Be,getAxisCount:We,getHatCount:Ge,getButtonState:Ye,getAxisState:Xe,getHatState:je,getKeyState:Ve,getAnalogState:ze}=w;class Qe{get id(){return Me(this)}get uuid(){return Ue(this)}get name(){return ke(this)}get type(){return'gamepad'}get buttonCount(){return Be(this)}get axisCount(){return We(this)}get hatCount(){return Ge(this)}isConnected(){return He(this)}getButtonState(t){return Ye(this,t)}getAxisState(t){return Xe(this,t)}getHatState(t){return je(this,t)}getKeyState(t){return Ve(this,t)}getAnalogState(t){return ze(this,t)}}const{getId:qe,getUUID:Je,getName:Ze,isConnected:ts,getScancodeState:es}=_;class ss{get id(){return qe(this)}get uuid(){return Je(this)}get name(){return Ze(this)}get type(){return'keyboard'}isConnected(){return ts(this)}getScancodeState(t){return es(this,t)}getKeyState(t){return false}getAnalogState(t){return false}}const is=0;const rs=1;const ns=2;const os=3;const as=4;const hs=5;const ls=t=>{switch(t){case is:return'init';case rs:return'loading';case ns:return'ready';case os:return'error';case as:return'detached';case hs:return'done';default:return'unknown'}};const{getWidth:us,getHeight:cs,getState:ds}=A;class gs{postConstruct(){}get width(){return us(this)}get height(){return cs(this)}get state(){return ls(ds(this))}}const{getUri:fs,getIndex:ps,getFamily:ys,getStyle:ms,getWeight:Es,getState:bs}=b;class ws{$postConstruct(){}get uri(){return fs(this)}get index(){return ps(this)}get family(){return ys(this)}get style(){switch(ms(this)){case 0:return'normal';case 1:return'italic';case 2:return'oblique';default:return'unknown'}}get weight(){switch(Es(this)){case 0:return'normal';case 1:return'bold';default:return'unknown'}}get state(){return ls(bs(this))}}const{bind:As}=T;const _s=({message:t,stack:e})=>{t&&console.log(t);e&&console.log(e);process.exit(1)};process.on('uncaughtException',_s);process.on('unhandledRejection',_s);c();As('lse_env',Et);As('lse_window',Vt);As('lse_style',Ct);As('lse_style_value',Zt);As('lse_root_node',Le);As('lse_box_node',xe);As('lse_image_node',De);As('lse_text_node',Ke);As('lse_display_mode',Oe);As('lse_renderer_info',Fe);As('lse_gamepad',Qe);As('lse_keyboard',ss);As('lse_image',gs);As('lse_font',ws);As('lse_style_filter',Jt);As('lse_style_transform',ne);As('lse_style_value',Zt);const Ts=Object.freeze({NONE:-1,LEFT:1,RIGHT:2,UP:3,DOWN:4});const Ps=Symbol.for('reset');const Rs=0;const Is=1;const Ns=2;const Ss=3;const Cs=4;const Ls=()=>{throw Error('selected node is required.')};class xs{[Ps](t,e){this.owner=t;this.direction=e;this.op=Rs;this.selected=null;return this}stop(){this.op=Is}pass(){this.op=Cs}move(t){t||Ls();this.selected=t;this.op=Ss}defer(t){t||Ls();this.selected=t;this.op=Ns}}const vs=(t,e,s)=>{if(e===Ts.NONE){return}const i=new xs;let r=t;let n=false;let o=null;while(r){const{waypoint:t}=r;if(t){t.navigate(i[Ps](r,e));switch(i.op){case Ss:o=i.selected;s.stopPropagation();break;case Cs:break;case Is:o=null;s.stopPropagation();break;case Ns:o=i.selected;n=true;break;default:throw Error(`Invalid op: ${i.op}`)}if(s.hasStopPropagation()){break}}r=r.parent}if(n){s.stopPropagation()}if(o){if(o.waypoint){r=o;while(true){r=r.waypoint.resolve({owner:r,pending:o,direction:e});if(!r||!(r.focusable||r.waypoint)){throw Error('resolve() must return a focus receiver')}if(r.focusable){break}}o=r}else if(!o.focusable){throw Error()}o.focus()}};const Ds=(t,e,s)=>{if(e===Ts.NONE){return}vs(t,e,s)};const $s=Object.freeze({A:0,B:1,X:2,Y:3,BACK:4,GUIDE:5,START:6,LEFT_STICK:7,RIGHT_STICK:8,LEFT_SHOULDER:9,RIGHT_SHOULDER:10,DPAD_UP:11,DPAD_DOWN:12,DPAD_LEFT:13,DPAD_RIGHT:14});const Ks=Object.freeze({LEFT_STICK_X:1e3,LEFT_STICK_Y:1001,RIGHT_STICK_X:1002,RIGHT_STICK_Y:1003,LEFT_TRIGGER:1004,RIGHT_TRIGGER:1005});const Os='System Keyboard';const Fs='00000000000000000000000000000001';const Ms=0;const Us=1;const ks=2;class Hs{type=-1;button;hat;axis;meta;constructor(t){this.type=t}isButton(){return this.type===Ms}isAxis(){return this.type===Us}isHat(){return this.type===ks}static forButton(t){const e=new Hs(Ms);if(!Number.isInteger(t)){throw Error('button must be an integer >= 0')}e.button=t;return e}static forAxis(t,e){const s=new Hs(Us);if(!Number.isInteger(t)||t<0){throw Error('axis index must be an integer >= 0')}if(e){switch(e){case'+':case'-':case'~':break;default:throw Error('axis meta must be a "+", "-", "~" or undefined')}}else{e=''}s.axis=t;s.meta=e;return s}static forHat(t,e){const s=new Hs(ks);if(!Number.isInteger(t)||t<0){throw Error('hat index must be an integer >= 0')}switch(e){case 1:case 2:case 4:case 8:break;default:throw Error('hat modifier must be an integer value of 1, 2, 4 or 8')}s.hat=t;s.meta=e;return s}}class Bs{static Value=Hs;_keys=new Map;_buttonToKey=new Map;constructor(t,e,s){if(typeof t!=='string'||t.length!==32){throw Error(`invalid uuid: ${t}`)}if(typeof e!=='string'||e.length===0){throw Error('name must be a string')}this.uuid=t;this.name=e;for(let[t,e]of s){if(!Number.isInteger(t)){throw Error('mapped key must be an integer. got: '+t)}if(typeof e==='string'){e=Qs(e)}else if(Number.isInteger(e)){e=Hs.forButton(e)}else if(e instanceof Hs);else if(h(e)){if('button'in e){e=Hs.forButton(e.button)}else if('axis'in e){e=Hs.forAxis(e.axis,e.meta)}else if('hat'in e){e=Hs.forHat(e.hat,e.meta)}else{throw Error('No button, axis or hat value set for hardware id')}}else{throw Error('Invalid hardware id: '+e)}if(e.isButton()){this._buttonToKey.set(e.button,t)}this._keys.set(t,e)}}getValue(t){return this._keys.get(t)??Ws}getKeyForButton(t){return this._buttonToKey.get(t)??-1}toCsv(){const t=[this.uuid,this.name];for(const[e,s]of this._keys){let i;let r;switch(s.type){case Ms:i=`b${s.button}`;break;case Us:r=s.meta==='~';i=`${r?'':s.meta}a${s.axis}${r?s.meta:''}`;break;case ks:i=`h${s.hat}.${s.meta}`;break;default:throw new Error(`unknown value type = ${s.type}`)}t.push(`${Vs.get(e)}:${i}`)}t.push(`platform:${zs.get(process.platform)??'?'}`);t.push('');return t.join(',')}static forKeyboard(t,e={}){const s=new Bs(Fs,e.name??Os,t);s._keys.forEach((t=>{if(!t.isButton()){throw Error('Keyboard mapping must only use scancodes, no hat or axis.')}}));return s}static forGamepad(t,e){return new Bs(e?.uuid,e?.name,t)}static fromCsv(t){const e=t?.split(',')||[];const s=e[0];const i=e[1];const r=[];if(e.length<3){throw Error(`invalid csv string: ${t}`)}for(let t=2;t<e.length;t++){if(!e[t]){continue}const n=e[t].split(':');if(n[0]==='platform'){return new Bs(s,i,r)}if(n.length!==2){throw Error(`expected a key:value entry at ${e[t]}`)}r.push([js.get(n[0]),n[1]])}throw Error('csv string must terminate with platform:PLATFORM_NAME')}}const Ws=new Hs;const Gs=/^b(\d+)$/;const Ys=/^h(\d+)\.([1248])$/;const Xs=/^(\+|-)?a(\d+)(~)?$/;const js=new Map([['a',$s.A],['b',$s.B],['x',$s.X],['y',$s.Y],['leftshoulder',$s.LEFT_SHOULDER],['rightshoulder',$s.RIGHT_SHOULDER],['start',$s.START],['back',$s.BACK],['guide',$s.GUIDE],['dpup',$s.DPAD_UP],['dpright',$s.DPAD_RIGHT],['dpdown',$s.DPAD_DOWN],['dpleft',$s.DPAD_LEFT],['rightstick',$s.RIGHT_STICK],['leftstick',$s.LEFT_STICK],['leftx',Ks.LEFT_STICK_X],['lefty',Ks.LEFT_STICK_Y],['rightx',Ks.RIGHT_STICK_X],['righty',Ks.RIGHT_STICK_Y],['lefttrigger',Ks.LEFT_TRIGGER],['righttrigger',Ks.RIGHT_TRIGGER]]);const Vs=l(js);const zs=new Map([['darwin','Mac OS X'],['win32','Windows'],['linux','Linux']]);const Qs=t=>{const e=()=>{throw Error('invalid hardware id: '+t)};let s;if(t.startsWith('b')){s=Gs.exec(t)||e();return Hs.forButton(parseInt(s[1]))}else if(t.startsWith('h')){s=Ys.exec(t)||e();return Hs.forHat(parseInt(s[1]),parseInt(s[2]))}s=Xs.exec(t)||e();return Hs.forAxis(parseInt(s[2]),s[3]??s[1])};const qs=Object.freeze({A:4,B:5,C:6,D:7,E:8,F:9,G:10,H:11,I:12,J:13,K:14,L:15,M:16,N:17,O:18,P:19,Q:20,R:21,S:22,T:23,U:24,V:25,W:26,X:27,Y:28,Z:29,NUM_1:30,NUM_2:31,NUM_3:32,NUM_4:33,NUM_5:34,NUM_6:35,NUM_7:36,NUM_8:37,NUM_9:38,NUM_0:39,RETURN:40,ESCAPE:41,BACKSPACE:42,TAB:43,SPACE:44,MINUS:45,EQUALS:46,LEFTBRACKET:47,RIGHTBRACKET:48,BACKSLASH:49,NONUSHASH:50,SEMICOLON:51,APOSTROPHE:52,GRAVE:53,COMMA:54,PERIOD:55,SLASH:56,CAPSLOCK:57,F1:58,F2:59,F3:60,F4:61,F5:62,F6:63,F7:64,F8:65,F9:66,F10:67,F11:68,F12:69,PRINTSCREEN:70,SCROLLLOCK:71,PAUSE:72,INSERT:73,HOME:74,PAGEUP:75,DELETE:76,END:77,PAGEDOWN:78,RIGHT:79,LEFT:80,DOWN:81,UP:82,NUMLOCKCLEAR:83,KP_DIVIDE:84,KP_MULTIPLY:85,KP_MINUS:86,KP_PLUS:87,KP_ENTER:88,KP_1:89,KP_2:90,KP_3:91,KP_4:92,KP_5:93,KP_6:94,KP_7:95,KP_8:96,KP_9:97,KP_0:98,KP_PERIOD:99,NONUSBACKSLASH:100,APPLICATION:101,POWER:102,KP_EQUALS:103,F13:104,F14:105,F15:106,F16:107,F17:108,F18:109,F19:110,F20:111,F21:112,F22:113,F23:114,F24:115,EXECUTE:116,HELP:117,MENU:118,SELECT:119,STOP:120,AGAIN:121,UNDO:122,CUT:123,COPY:124,PASTE:125,FIND:126,MUTE:127,VOLUMEUP:128,VOLUMEDOWN:129,KP_COMMA:133,KP_EQUALSAS400:134,INTERNATIONAL1:135,INTERNATIONAL2:136,INTERNATIONAL3:137,INTERNATIONAL4:138,INTERNATIONAL5:139,INTERNATIONAL6:140,INTERNATIONAL7:141,INTERNATIONAL8:142,INTERNATIONAL9:143,LANG1:144,LANG2:145,LANG3:146,LANG4:147,LANG5:148,LANG6:149,LANG7:150,LANG8:151,LANG9:152,ALTERASE:153,SYSREQ:154,CANCEL:155,CLEAR:156,PRIOR:157,RETURN2:158,SEPARATOR:159,OUT:160,OPER:161,CLEARAGAIN:162,CRSEL:163,EXSEL:164,KP_00:176,KP_000:177,THOUSANDSSEPARATOR:178,DECIMALSEPARATOR:179,CURRENCYUNIT:180,CURRENCYSUBUNIT:181,KP_LEFTPAREN:182,KP_RIGHTPAREN:183,KP_LEFTBRACE:184,KP_RIGHTBRACE:185,KP_TAB:186,KP_BACKSPACE:187,KP_A:188,KP_B:189,KP_C:190,KP_D:191,KP_E:192,KP_F:193,KP_XOR:194,KP_POWER:195,KP_PERCENT:196,KP_LESS:197,KP_GREATER:198,KP_AMPERSAND:199,KP_DBLAMPERSAND:200,KP_VERTICALBAR:201,KP_DBLVERTICALBAR:202,KP_COLON:203,KP_HASH:204,KP_SPACE:205,KP_AT:206,KP_EXCLAM:207,KP_MEMSTORE:208,KP_MEMRECALL:209,KP_MEMCLEAR:210,KP_MEMADD:211,KP_MEMSUBTRACT:212,KP_MEMMULTIPLY:213,KP_MEMDIVIDE:214,KP_PLUSMINUS:215,KP_CLEAR:216,KP_CLEARENTRY:217,KP_BINARY:218,KP_OCTAL:219,KP_DECIMAL:220,KP_HEXADECIMAL:221,LCTRL:224,LSHIFT:225,LALT:226,LGUI:227,RCTRL:228,RSHIFT:229,RALT:230,RGUI:231,MODE:257,AUDIONEXT:258,AUDIOPREV:259,AUDIOSTOP:260,AUDIOPLAY:261,AUDIOMUTE:262,MEDIASELECT:263,WWW:264,MAIL:265,CALCULATOR:266,COMPUTER:267,AC_SEARCH:268,AC_HOME:269,AC_BACK:270,AC_FORWARD:271,AC_STOP:272,AC_REFRESH:273,AC_BOOKMARKS:274,BRIGHTNESSDOWN:275,BRIGHTNESSUP:276,DISPLAYSWITCH:277,KBDILLUMTOGGLE:278,KBDILLUMDOWN:279,KBDILLUMUP:280,EJECT:281,SLEEP:282,APP1:283,APP2:284,AUDIOREWIND:285,AUDIOFASTFORWARD:286});const{$registerEventCallbacks:Js,$resetEventCallbacks:Zs,$getKeyboard:ti,$getGamepads:ei,$getMapping:si,$setMapping:ii,$resetMapping:ri}=E;const ni=[ye,de];const oi=[pe,ge];class ai extends D{#P=null;#R=new Map;#I=null;#N=null;#S=u();#C=null;#L=null;constructor(t){super();this.#P=t;this.#N=[t.on(H,this.#x.bind(this)),t.on(M,this.#v.bind(this))];this.#D()}get gamepads(){return[...this.#R.values()]}get keyboard(){return this.#I}setMapping(t){if(!(t instanceof Bs)){throw Error('expected Mapping instance')}if(t.uuid===this.#I?.uuid){this.#C=t}else{ii(this.#P,t.uuid,t.toCsv())}}getMapping(t){if(t===this.#I?.uuid){return this.#C}else{const e=si(this.#P,t);return e?Bs.fromCsv(e):undefined}}resetMapping(t){if(t===this.#I?.uuid){this.#C=hi()}else{ri(this.#P,t)}}#x(){const t=this.#P;Js(t,{gamepad_status:this.#$.bind(this),gamepad_button:this.#K.bind(this),keyboard_button:this.#O.bind(this),gamepad_axis_motion:this.#F.bind(this),gamepad_hat_motion:this.#M.bind(this)});this.#I=ti(t);this.resetMapping(this.#I.uuid);ei(t).forEach((t=>{this.#R.set(t.id,t);this.emitEvent(new ue(this,t,true))}))}#v(){Zs(this.#P);this.#N.forEach((t=>t()));this.#N=null;this.#R.clear();this.#I=null;this.#C=null;this.#P=null}#$(t,e){if(e){this.#R.set(t.id,t)}else{this.#R.delete(t.id)}this.emitEvent(new ue(this,t,e))}#O(t,e,s,i){this.#S=u();const{keyboard:r}=this;this.#U(new fe(this,r,e,s,i));const n=this.#C.getKeyForButton(e);if(n===-1){return}const o=new pe(this,r,n,s,i);if(s){Ds(this.#P.$getPrimaryWindow().activeNode,this.#L.get(n)??Ts.NONE,o)}this.#U(o)}#K(t,e,s,i,r){this.#S=u();const n=this.#R.get(t);const o=oi[e];this.#U(new o(this,n,s,i,r))}#F(t,e,s,i){this.#S=u();const r=this.#R.get(t);const n=ni[e];this.#U(new n(this,r,s,i))}#M(t,e,s,i){this.#S=u();const r=this.#R.get(t);this.#U(new ce(this,r,s,i))}#U(t){this.emitEvent(t);if(t.hasStopPropagation()){return}const{activeNode:e}=this.#P.$getPrimaryWindow();if(e){t.target=e;e.$bubble(t)}}#D(){this.#L=new Map([[$s.DPAD_UP,Ts.UP],[$s.DPAD_RIGHT,Ts.RIGHT],[$s.DPAD_DOWN,Ts.DOWN],[$s.DPAD_LEFT,Ts.LEFT]])}}const hi=()=>Bs.forKeyboard([[$s.A,qs.Z],[$s.B,qs.X],[$s.X,qs.A],[$s.Y,qs.S],[$s.START,qs.RETURN],[$s.BACK,qs.RSHIFT],[$s.LEFT_SHOULDER,qs.Q],[$s.RIGHT_SHOULDER,qs.W],[$s.DPAD_UP,qs.UP],[$s.DPAD_DOWN,qs.DOWN],[$s.DPAD_LEFT,qs.LEFT],[$s.DPAD_RIGHT,qs.RIGHT]]);const li=Object.freeze({CENTERED:0,UP:1,RIGHT:2,DOWN:4,LEFT:8});const{UP:ui,DOWN:ci,LEFT:di,RIGHT:gi}=Ts;const fi='horizontal';const pi='vertical';const yi=1;const mi=2;const Ei=[[],[0,-1,1,0,0],[0,0,0,-1,1]];class bi{constructor(t){if(t===fi){this._navigation=yi;this.tag=fi}else if(t===pi){this._navigation=mi;this.tag=pi}else{throw Error(`FixedListWaypoint expected tag ${fi} or ${pi}. Got ${t}`)}this._focalPathIndex=-1}navigate(t){const{owner:e,direction:s}=t;const i=Ei[this._navigation][s];if(!i){return t.pass()}if(this._focalPathIndex===-1){this.sync(e)}const r=this._focalPathIndex+i;const n=_i(e);if(r<0){this._focalPathIndex=0;return t.defer(n[0])}else if(r>=n.length){this._focalPathIndex=n.length-1;return t.defer(n[n.length-1])}else{this._focalPathIndex=r;return t.move(n[r])}}resolve(t){const{owner:e,pending:s,direction:i}=t;let r=this._focalPathIndex;const n=this._navigation;const o=_i(e);if(s&&!Ti(s,e)){switch(i){case ci:if(n===mi){r=0}break;case ui:if(n===mi){r=o.length-1}break;case gi:if(n===yi){r=0}break;case di:if(n===yi){r=o.length-1}break;default:throw Error(`Unknown direction: ${i}`)}}if(r===-1){r=0}return o[this._focalPathIndex=r]}sync(t){let e=0;for(const s of _i(t)){if(wi(s)){this._focalPathIndex=e;return}e++}}}const wi=t=>t.hasFocus()||t.childNodes.some((t=>wi(t)));const Ai=t=>{if(t.waypoint||t.focusable){return t}let e;for(const s of t.childNodes){if(e=Ai(s)){return e}}return null};const _i=t=>{const e=[];let s;for(const i of t.childNodes){(s=Ai(i))&&e.push(s)}if(!e.length){throw Error('Waypoint expects to be associated with a node with focusable children.')}return e};const Ti=(t,e)=>{let s=t;while(s){if(e===s.parent){return true}s=s.parent}return false};const Pi=t=>new bi(t);const Ri=()=>{process.exit(0)};process.on('SIGINT',Ri);process.on('SIGTERM',Ri);const Ii=Et.new();const Ni=new ai(Ii);const Si=Ii.$addWindow();const Ci='2.0.0';const Li=(t={})=>{Ii.configure(t);Si.configure(t.window)};const xi={Style:{assign:Ut.assign,StyleClass:Ut.StyleClass,StyleSheet:Ut.StyleSheet,StyleFilter:Jt,StyleTransform:ne,StyleValue:Zt}};export{Ks as AnalogKey,li as Hat,$s as Key,qs as Scancode,xi as __internal,Ii as env,Ni as input,Li as letThereBeLight,Ci as version,Pi as waypoint,Si as window};
